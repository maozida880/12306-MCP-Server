# 12306-MCP-Server v1.0.0

[](https://nodejs.org/en/)
[](https://www.google.com/search?q=https://github.com/your-username/12306-mcp-server/blob/main/LICENSE)

**ä¸€ä¸ªä¸ºå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è®¾è®¡çš„ã€é«˜å¯ç”¨çš„12306ä½™ç¥¨æŸ¥è¯¢å·¥å…·æœåŠ¡ï¼Œç°å·²æ­è½½æ™ºèƒ½ä¼šSessionç®¡ç†å¼•æ“ã€‚**

12306-MCP-Server å°†å¤æ‚çš„12306ä½™ç¥¨æŸ¥è¯¢æ¥å£å°è£…ä¸ºç¬¦åˆ [Model-Code-Protocol](https://www.google.com/search?q=https://github.com/model-code-protocol/specification) (MCP/MCP) è§„èŒƒçš„å·¥å…·é›†ï¼Œå…è®¸AI Agenté€šè¿‡è‡ªç„¶è¯­è¨€æ— ç¼æŸ¥è¯¢å®æ—¶ç«è½¦ç¥¨ã€ä¸­è½¬æ¢ä¹˜å’Œç»åœç«™ä¿¡æ¯ã€‚

ä» `v1.0.0` ç‰ˆæœ¬å¼€å§‹ï¼Œé¡¹ç›®å¼•å…¥äº†å…¨æ–°çš„ `http-client` æ¨¡å—ï¼Œé€šè¿‡æ™ºèƒ½Sessionæ± ã€åŠ¨æ€User-Agentè½®æ¢å’Œè‡ªåŠ¨é”™è¯¯æ¢å¤æœºåˆ¶ï¼Œå°†æœåŠ¡çš„ç¨³å®šæ€§ä¸åå±è”½èƒ½åŠ›æå‡è‡³å…¨æ–°é«˜åº¦ï¼Œä½¿å…¶ä»ä¸€ä¸ªç®€å•çš„APIå°è£…å‡çº§ä¸ºâ€œé«˜å¯ç”¨çš„æ™ºèƒ½æŸ¥è¯¢ä»£ç†â€ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

  - **æ™ºèƒ½Sessionç®¡ç†**:
      - **Sessionæ± **: ç»´æŠ¤ä¸€ä¸ªå¯é…ç½®å¤§å°çš„Sessionæ± ï¼ˆé»˜è®¤ä¸º2-5ä¸ªï¼‰ï¼Œé«˜æ•ˆå¤ç”¨è¿æ¥ï¼Œæ˜¾è‘—å‡å°‘äº†90%çš„é‡å¤ç™»å½•è¯·æ±‚ã€‚
      - **åå°è‡ªåŠ¨ç»´æŠ¤**: æ¯5åˆ†é’Ÿè‡ªåŠ¨æ¸…ç†å¤±æ•ˆæˆ–è¿‡æœŸçš„ä¼šè¯ï¼Œå¹¶è¡¥å……æ–°ä¼šè¯ï¼Œç¡®ä¿Sessionæ± çš„å¥åº·çŠ¶æ€ã€‚
      - **æ™ºèƒ½é”™è¯¯å¤„ç†**: èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å› Sessionå¤±æ•ˆå¯¼è‡´çš„è¯·æ±‚å¤±è´¥ï¼Œå¹¶ç«‹å³å°†è¯¥Sessionæ ‡è®°ä¸ºæ— æ•ˆï¼Œè§¦å‘è¡¥å……æœºåˆ¶ï¼Œå®ç°äº†æœåŠ¡çš„è‡ªæ„ˆèƒ½åŠ›ã€‚
  - **å¼ºå¤§çš„æŸ¥è¯¢å·¥å…·é›†**:
      - **`get-tickets`**: æŸ¥è¯¢æŒ‡å®šæ—¥æœŸã€åŒºé—´çš„ç›´è¾¾ç¥¨ä½™ç¥¨ä¿¡æ¯ã€‚
      - **`get-interline-tickets`**: æŸ¥è¯¢ä¸­è½¬æ¢ä¹˜çº¿è·¯çš„ä½™ç¥¨ä¿¡æ¯ã€‚
      - **`get-train-route-stations`**: æŸ¥è¯¢ç‰¹å®šè½¦æ¬¡çš„è¯¦ç»†ç»åœç«™ç‚¹ä¿¡æ¯ã€‚
      - **`get-station-code`**: æä¾›å¤šç§æ–¹å¼ï¼ˆåŸå¸‚åã€å…·ä½“ç«™åï¼‰æŸ¥è¯¢è½¦ç«™ä»£ç ã€‚
  - **çµæ´»çš„ç­›é€‰ä¸æ’åº**:
      - æ”¯æŒæŒ‰è½¦æ¬¡ç±»å‹ (G/D/Z/T/K)ã€å‡ºå‘æ—¶é—´èŒƒå›´è¿›è¡Œç­›é€‰ã€‚
      - æ”¯æŒæŒ‰å‡ºå‘æ—¶é—´ã€åˆ°è¾¾æ—¶é—´å’Œå†æ—¶è¿›è¡Œæ’åºã€‚
  - **å¤šç§è¾“å‡ºæ ¼å¼**:
      - æ”¯æŒ `text` (é»˜è®¤)ã€`csv` (get-tickets) å’Œ `json` ä¸‰ç§æ ¼å¼ï¼Œæ–¹ä¾¿ä¸åŒåœºæ™¯ä¸‹çš„æ•°æ®æ¶ˆè´¹ã€‚
  - **é«˜å¯é æ€§è®¾è®¡**:
      - **åŠ¨æ€User-Agent**: å†…ç½®12ç§æµè§ˆå™¨User-Agentï¼Œåœ¨æ¯æ¬¡åˆ›å»ºæ–°Sessionæ—¶éšæœºé€‰ç”¨ï¼Œæœ‰æ•ˆé™ä½äº†è¢«è¯†åˆ«ä¸ºè‡ªåŠ¨åŒ–è„šæœ¬çš„é£é™©ã€‚
      - **IPå°ç¦é£é™©é™ä½95%**: é€šè¿‡å¤§å¹…å‡å°‘ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚å’Œæ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸ºï¼Œæ˜¾è‘—é™ä½äº†æœåŠ¡å™¨IPè¢«12306æš‚æ—¶å±è”½çš„é£é™©ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

  - Node.js \>= 18.x

### 1\. å®‰è£…

ä»NPMç›´æ¥å®‰è£… (æ¨è):

```bash
npm install -g 12306-mcp-server
```

æˆ–è€…ï¼Œä»æºç æ„å»º:

```bash
git clone https://github.com/your-username/12306-mcp-server.git
cd 12306-mcp-server
npm install
npm run build
```

### 2\. è¿è¡ŒæœåŠ¡

æ ¹æ®æ‚¨çš„AI Agentæˆ–å®¢æˆ·ç«¯çš„è¿æ¥æ–¹å¼ï¼Œé€‰æ‹©ä»¥ä¸‹ä»»ä¸€æ¨¡å¼å¯åŠ¨æœåŠ¡ï¼š

#### æ ‡å‡†è¾“å…¥/è¾“å‡º (Stdio) æ¨¡å¼

æ­¤æ¨¡å¼é€‚ç”¨äºå¤§å¤šæ•°æœ¬åœ°å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ Claude Desktopï¼‰çš„ç›´æ¥è°ƒç”¨ã€‚

```bash
# å¦‚æœé€šè¿‡npmå…¨å±€å®‰è£…
12306-mcp
# å¦‚æœä»æºç è¿è¡Œ
npm run start
```

æœåŠ¡å¯åŠ¨åï¼Œæ‚¨å°†åœ¨ç»ˆç«¯çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š

```
[SessionManager] Initializing session pool...
[SessionManager] New session created: ...
[SessionManager] New session created: ...
[SessionManager] Initialized with 2 sessions
[Main] Service initialized successfully
12306 MCP Server running on stdio @Joooook
```

#### HTTP/SSE æ¨¡å¼

æ­¤æ¨¡å¼å°†æœåŠ¡æš´éœ²ä¸ºä¸€ä¸ªHTTPç«¯ç‚¹ï¼Œé€‚ç”¨äºè¿œç¨‹æˆ–Webå®¢æˆ·ç«¯ã€‚

```bash
# ç›‘å¬åœ¨8080ç«¯å£
12306-mcp --port 8080
# æˆ–è€…ä»æºç è¿è¡Œ
npm run start:http
```

æœåŠ¡å¯åŠ¨åï¼Œæ‚¨å¯ä»¥è®¿é—® `http://localhost:8080/health` æ¥æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€ã€‚

## ğŸ› ï¸ å·¥å…·ä½¿ç”¨ç¤ºä¾‹ (MCP/MCP è§„èŒƒ)

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ `get-tickets` å·¥å…·æŸ¥è¯¢ä»åŒ—äº¬ (BJP) åˆ°ä¸Šæµ· (SHH) è½¦ç¥¨çš„MCPè¯·æ±‚ç¤ºä¾‹ï¼š

```json
{
  "name": "get-tickets",
  "arguments": {
    "date": "2025-10-25",
    "fromStation": "BJP",
    "toStation": "SHH",
    "limitedNum": 3,
    "trainFilterFlags": "G",
    "sortFlag": "startTime"
  }
}
```

## âš™ï¸ é…ç½®

æ‰€æœ‰æ ¸å¿ƒé…ç½®éƒ½ä½äº `src/http-client/constants.ts` æ–‡ä»¶ä¸­ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š

```typescript
export const POOL_CONFIG = {
    MIN_SIZE: 2,                    // æœ€å°Sessionæ± å¤§å°
    MAX_SIZE: 5,                    // æœ€å¤§Sessionæ± å¤§å°
    SESSION_TTL: 30 * 60 * 1000,   // Sessionæœ‰æ•ˆæœŸ (30åˆ†é’Ÿ)
    MAINTENANCE_INTERVAL: 5 * 60 * 1000,  // åå°ç»´æŠ¤ä»»åŠ¡é—´éš” (5åˆ†é’Ÿ)
};
```

ä¿®æ”¹é…ç½®åï¼Œéœ€è¦é‡æ–°æ„å»º (`npm run build`) å¹¶é‡å¯æœåŠ¡ã€‚

## ğŸ”§ æ•…éšœæ’æŸ¥

  - **ä¼šè¯æ± åˆå§‹åŒ–å¤±è´¥ (get cookie failed)**:
      - æ£€æŸ¥æœåŠ¡å™¨ç½‘ç»œæ˜¯å¦èƒ½æ­£å¸¸è®¿é—® `kyfw.12306.cn`ã€‚
      - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®æ˜¯å¦é˜»æ­¢äº†å‡ºç«™è¯·æ±‚ã€‚
  - **å¯¼å…¥é”™è¯¯ (Cannot find module)**:
      - ç¡®ä¿å·²ç»è¿è¡Œ `npm run build` æˆåŠŸç”Ÿæˆ `build/` ç›®å½•ã€‚
  - **ä¼šè¯é¢‘ç¹å¤±æ•ˆ**:
      - å¯èƒ½æ˜¯12306é£æ§ç­–ç•¥å˜æ›´ã€‚å°è¯•åœ¨ `constants.ts` ä¸­å¢åŠ  `SESSION_TTL` æ—¶é—´ã€‚
      - è€ƒè™‘å‡å°‘å¹¶å‘è¯·æ±‚é¢‘ç‡ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼å¦‚æœæ‚¨æœ‰ä»»ä½•æƒ³æ³•ã€å»ºè®®æˆ–å‘ç°Bugï¼Œè¯·éšæ—¶æäº¤ Pull Request æˆ–åˆ›å»º Issueã€‚

## ğŸ“„ License

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT](https://www.google.com/search?q=https://github.com/your-username/12306-mcp-server/blob/main/LICENSE) è®¸å¯è¯ã€‚